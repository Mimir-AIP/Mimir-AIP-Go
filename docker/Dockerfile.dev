# Development Dockerfile with hot reload
FROM golang:1.23-alpine

# Install development dependencies
RUN apk add --no-cache git ca-certificates air

WORKDIR /app

# Copy go mod files
COPY go.mod go.sum ./
RUN go mod download

# Copy source code
COPY . .

# Install air for hot reload
RUN go install github.com/cosmtrek/air@latest

# Create directories
RUN mkdir -p /app/data /app/logs /app/plugins

# Expose port
EXPOSE 8080

# Environment variables for development
ENV MIMIR_PORT=8080
ENV MIMIR_LOG_LEVEL=DEBUG
ENV MIMIR_DATA_DIR=/app/data
ENV MIMIR_LOG_DIR=/app/logs
ENV MIMIR_PLUGIN_DIR=/app/plugins

# Volume mounts for development
VOLUME ["/app"]

# Entry point with hot reload
ENTRYPOINT ["air", "-c", ".air.toml"]